@{
    ViewData["Title"] = "PROJEKT 101 - SKAPA NYTT";
}

<div class="container mt-5">
    <h2 class="mb-4">PROJEKT 101 - SKAPA NYTT</h2>

    <form method="post" action="/CreatePage/Save">

        <!-- 📌 SECTION 1: PROJEKTINFO -->
        <div class="border p-3 mb-4">
            <h4 class="mb-3">Projektinfo</h4>
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="projectNumber" class="form-label">Projektnr</label>
                    <input type="text" class="form-control" id="projectNumber" name="ProjectNumber" value="P-101" readonly>
                </div>
                <div class="col-md-6">
                    <label for="projectName" class="form-label">Benämning</label>
                    <input type="text" class="form-control" id="projectName" name="ProjectName" required>
                </div>
                <div class="col-md-3">
                    <label for="startDate" class="form-label">Startdatum</label>
                    <input type="date" class="form-control" id="startDate" name="StartDate" required>
                </div>

                <div class="col-md-3">
                    <label for="endDate" class="form-label">Slutdatum</label>
                    <input type="date" class="form-control" id="endDate" name="EndDate">
                </div>
                <div class="col-md-3">
                    <label for="status" class="form-label">Status</label>
                    <select class="form-select" id="status" name="Status">
                        <option>Pågår</option>
                        <option>Avslutat</option>
                        <option>Planerat</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="projectLeader" class="form-label">Projektledare</label>
                    <div class="d-flex gap-2 align-items-center">
                        <select class="form-select flex-grow-1" id="projectLeader" name="ProjectLeader" style="height: 38px;">
                            <option>Anna Andersson</option>
                            <option>Johan Karlsson</option>
                            <option>Maria Svensson</option>
                            <option>Oskar Johansson</option>
                        </select>
                        <button type="button" class="btn btn-secondary" style="width: 150px; height: 38px;" data-bs-toggle="modal" data-bs-target="#createProjectLeaderModal">
                            Skapa ny
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ✅ Section 1 - Modal för att skapa ny projektledare -->
        <div class="modal fade" id="createProjectLeaderModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Skapa ny projektledare</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="text" class="form-control mb-2" id="newProjectLeaderFirstName" placeholder="Förnamn">
                        <input type="text" class="form-control mb-2" id="newProjectLeaderLastName" placeholder="Efternamn">
                        <button class="btn btn-primary mt-2" id="saveProjectLeader">Lägg till</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- 📌 SECTION 2: BESTÄLLNING -->
        <div class="border p-3 mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-3">Beställningar</h4>
                <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#createOrderModal">Skapa ny beställning</button>
            </div>

            <!-- Lista över beställningar -->
            <ul class="list-group mt-3" id="orderList"></ul>
        </div>

        <!-- ✅ Modal för att skapa ny beställning -->
        <div class="modal fade" id="createOrderModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Skapa ny beställning</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <!-- Dropdown för Tjänst -->
                        <label class="form-label">Tjänst</label>
                        <select class="form-select mb-2" id="orderService">
                            <option value="Städning">Städning</option>
                            <option value="Fönsterputs">Fönsterputs</option>
                            <option value="Gräsklippning">Gräsklippning</option>
                            <option value="Snöröjning">Snöröjning</option>
                        </select>

                        <!-- Fält för timmar -->
                        <label class="form-label">Timmar</label>
                        <input type="number" class="form-control mb-2" id="orderHours" placeholder="Antal timmar">

                        <!-- Fält för pris per timme -->
                        <label class="form-label">Pris per timme</label>
                        <input type="number" class="form-control mb-2" id="orderPricePerHour" placeholder="Pris per timme">

                        <!-- Dropdown för Kund -->
                        <label class="form-label">Kund</label>
                        <select class="form-select mb-2" id="orderCustomer">
                            <option value="Företag A">Företag A</option>
                            <option value="Företag B">Företag B</option>
                            <option value="Företag C">Företag C</option>
                            <option value="Företag D">Företag D</option>
                        </select>

                        <!-- Spara-knapp -->
                        <button class="btn btn-primary mt-2" id="saveOrder">Lägg till beställning</button>
                    </div>
                </div>
            </div>
        </div>






        <!-- 📌 SECTION 3: SAMMANSTÄLLNING -->
        <div class="border p-3">
            <h4 class="mb-3">Sammanställning</h4>
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">Totala Timmar</label>
                    <input type="text" class="form-control" id="totalHours" readonly>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Total Pris</label>
                    <input type="text" class="form-control" id="totalPrice" readonly>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Anteckningar</label>
                    <textarea class="form-control" id="notes" name="Notes" rows="3"></textarea>
                </div>
            </div>
        </div>

        <div class="mt-4 d-flex justify-content-end gap-3">
            <a asp-controller="Home" asp-action="Index" type="reset" class="btn btn-secondary">Avbryt</a>
            <button type="submit" class="btn btn-success">Spara</button>
        </div>
    </form>
</div>



<!--   ✅ JavaScript Sektion 1: Hantera "Skapa ny Projektledare" -->
<script>
    document.getElementById('saveProjectLeader').addEventListener('click', function () {
        const firstName = document.getElementById('newProjectLeaderFirstName').value.trim();
        const lastName = document.getElementById('newProjectLeaderLastName').value.trim();
        if (firstName && lastName) {
            const fullName = `${firstName} ${lastName}`;
            const projectLeaderDropdown = document.getElementById('projectLeader');

            // Skapa och lägg till nytt alternativ i dropdown-menyn
            const option = new Option(fullName, fullName);
            projectLeaderDropdown.add(option);
            projectLeaderDropdown.value = fullName;

            // Rensa inputfälten och stäng modalen
            document.getElementById('newProjectLeaderFirstName').value = '';
            document.getElementById('newProjectLeaderLastName').value = '';
            bootstrap.Modal.getInstance(document.getElementById('createProjectLeaderModal')).hide();
        }
    });
</script>

<!-- ✅ JavaScript Sektion 2: Hantera "Skapa ny beställning" -->
<script>
    // 🔵 JavaScript Sektion 2: Hantera "Skapa ny beställning" och uppdatera listan och sammanställning

    // Funktion för att uppdatera sammanställning (Sektion 3)
    function updateSummary() {
        let totalHours = 0;
        let totalPrice = 0;

        // Loopa igenom alla beställningar i listan
        document.querySelectorAll('#orderList li').forEach(order => {
            const text = order.querySelector('div').innerText;
            const match = text.match(/(\d+) timmar x (\d+) kr\/timme = (\d+) kr/);

            if (match) {
                totalHours += parseInt(match[1], 10); // Lägg till timmar
                totalPrice += parseInt(match[3], 10); // Lägg till totalpris
            }
        });

        // Uppdatera fälten i sammanställningen (Sektion 3)
        document.getElementById('totalHours').value = totalHours;
        document.getElementById('totalPrice').value = `${totalPrice} kr`;
    }

    // Eventlistener för "Lägg till beställning" från popupen
    document.getElementById('saveOrder').addEventListener('click', function () {
        const serviceTitle = document.getElementById('orderService').value; // Uppdaterat för dropdown
        const hours = parseInt(document.getElementById('orderHours').value.trim(), 10);
        const pricePerHour = parseInt(document.getElementById('orderPricePerHour').value.trim(), 10);
        const customer = document.getElementById('orderCustomer').value;

        if (serviceTitle && !isNaN(hours) && !isNaN(pricePerHour) && customer) {
            const totalPrice = hours * pricePerHour;
            const orderList = document.getElementById('orderList');

            // Lägg till ny beställning i listan
            const listItem = document.createElement('li');
            listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
            listItem.innerHTML = `
                        <div>
                            <strong>${serviceTitle}</strong> - ${hours} timmar x ${pricePerHour} kr/timme = <strong>${totalPrice} kr</strong>
                            <br><small>Kund: ${customer}</small>
                        </div>
                        <button type="button" class="btn btn-danger btn-sm remove-order">Ta bort</button>
                    `;
            orderList.appendChild(listItem);

            // Uppdatera sammanställningen (Sektion 3)
            updateSummary();

            // Rensa inputfält och stäng modal
            document.getElementById('orderService').value = ''; // Uppdaterat för dropdown
            document.getElementById('orderHours').value = '';
            document.getElementById('orderPricePerHour').value = '';
            bootstrap.Modal.getInstance(document.getElementById('createOrderModal')).hide();
        }
    });

    // Eventlistener för "Ta bort beställning"
    document.getElementById('orderList').addEventListener('click', function (e) {
        if (e.target.classList.contains('remove-order')) {
            e.target.closest('li').remove(); // Ta bort beställningen från listan
            updateSummary(); // Uppdatera sammanställningen efter borttagning
        }
    });
</script>

<!-- ✅ JavaScript Sektion 3: Hantera "Skapa ny beställning" -->
<!--Ingen förnuvarande-->



<!-- ✅ JavaScript -->
<script>
    document.getElementById('saveService').addEventListener('click', function () {
        const title = document.getElementById('newServiceTitle').value;
        const hours = document.getElementById('newServiceHours').value;
        const price = document.getElementById('newServicePrice').value;
        if (title && hours && price) {
            const listItem = document.createElement('li');
            listItem.className = 'list-group-item';
            listItem.innerHTML = `${title} - ${hours} timmar - ${price} kr`;
            document.getElementById('serviceList').appendChild(listItem);
            document.getElementById('newServiceTitle').value = '';
            document.getElementById('newServiceHours').value = '';
            document.getElementById('newServicePrice').value = '';
            bootstrap.Modal.getInstance(document.getElementById('createServiceModal')).hide();
        }
    });
</script>
